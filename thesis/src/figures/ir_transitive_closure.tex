\begin{figure}[tpb]
	\centering

	\begin{tabular}{c}
		\begin{lstlisting}[keepspaces,escapechar=!]
edges   <-  LiteralExpr(Relation { schema: ["from", "to", "weight"] })
base    <-  ProjectionExpr {
                relation: VarExpr("edges"),
                attributes: [
                   ("from", !\tikzmark{basestart}!VarExpr("from")!\tikzmark{baseend}!),
                   ("to", !\tikzmark{basestart}!VarExpr("to")!\tikzmark{baseend}!),
                   ("cweight", !\tikzmark{basestart}!VarExpr("weight")!\tikzmark{baseend}!),
                   ("hopcnt", !\tikzmark{basestart}!LiteralExpr(UInt(1))!\tikzmark{baseend}!),
                ]
            }
closure <-  FixPointIterExpr {
                imports: ["edges"],
                accumulator: ("acc", VarExpr("base")),
                step: BlockStmt {
                    stmts: [
                        ExprStmt {
                            expr: EquiJoinExpr {
                                left: AliasExpr {
                                    relation: VarExpr("acc"),
                                    alias: "cur",
                                },
                                right: AliasExpr {
                                    relation: VarExpr("edges"),
                                    alias: "next",
                                },
                                on: [(VarExpr("cur.to"), VarExpr("next.from"))],
                                attributes: [
                                    ("from", VarExpr("cur.from")),
                                    ("to", VarExpr("next.to")),
                                    ("cweight", BinaryExpr {
                                        op: Operator::Add,
                                        left: VarExpr("cur.cweight"),
                                        right: VarExpr("next.weight")
                                    }),
                                    ("hopcnt", BinaryExpr {
                                        op: Operator::Add,
                                        left: VarExpr("cur.hopcnt"),
                                        right: LiteralExpr(UInt(1))
                                    })
                                ]
            }}]}}\end{lstlisting}
	\end{tabular}

	\begin{tikzpicture}[remember picture,overlay]
		\draw[red,rounded corners]
		([shift={(-3pt,2ex)}]pic cs:basestart)
		rectangle
		([shift={(3pt,-0.65ex)}]pic cs:baseend);
	\end{tikzpicture}

	% \vspace{1em}

	% \begin{subfigure}[b]{\textwidth}
	% 	\centering
	% 	\begin{tikzpicture}
	% 		\small

	% 		\tikzset{
	% 			node distance=38pt and 48pt,
	% 			on grid,
	% 			node/.style={rectangle,minimum width=0pt,minimum height=0pt,align=center,fill=white},
	% 			input/.style={edge},
	% 			edgelabel/.style={midway},
	% 			pipeline/.style={rectangle,thick,draw=gray,inner sep=2pt},
	% 		}

	% 		\node[node] (projection) {\(\pi_{[\mathit{Key}, \mathit{Value}]}\)};
	% 		\node[node,below=of projection] (antijoin) {\(\triangleright_{[\mathit{RepId}, \mathit{Ctr}]}\)};

	% 		\node[node,below left=of antijoin] (equijoin) {\(\bowtie_{[\mathit{RepId}, \mathit{Ctr}]}\)};
	% 		\node[node,below right=of antijoin] (overwritten) {overwritten};

	% 		\node[node,below left=of equijoin] (set) {set};
	% 		\node[node,below right=of equijoin] (caus) {isCausallyReady};

	% 		\begin{scope}[on background layer]
	% 			\draw[input] (antijoin) to[] (projection);

	% 			\draw[input] (overwritten) to[] (antijoin);
	% 			\draw[input] (equijoin) to[] (antijoin);

	% 			\draw[input] (set) to[] (equijoin);
	% 			\draw[input] (caus) to[] (equijoin);

	% 			\node[pipeline,draw=TUMAccentGreen,dashed,fit=(set) (caus) (equijoin)] (pospart) {};
	% 			\node[anchor=north east,color=TUMAccentGreen] at (pospart.south east) {positive part};

	% 			\node[pipeline,draw=TUMAccentOrange,dashdotted,fit=(equijoin) (antijoin) (overwritten)] (negpart) {};
	% 			\node[anchor=south east,color=TUMAccentOrange] at (negpart.north east) {negative part};

	% 			\node[pipeline,draw=TUMAccentBlue,densely dotted,fit=(projection)] (headpart) {};
	% 			\node[anchor=south east,color=TUMAccentBlue] at (headpart.north east) {head vars};
	% 		\end{scope}
	% 	\end{tikzpicture}
	% 	\caption{Query plan with an antijoin to handle the negative ``overwritten'' atom.}\label{fig:negative-query-plan}
	% \end{subfigure}

	\caption{The computation of a transitive closure in the \ac{IR}.}\label{code:trans-closure-ir}
\end{figure}
